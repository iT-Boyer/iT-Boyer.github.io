<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Docker使用 - 习七</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="iTBoyer"><meta name=description content="安装Docker for Mac 在Mac上运行Docker。系统要求，OS X 10.10.3 或者更高版本，至少4G内存，4.3.30版本以前的VirtualBox会与Docker for Mac产生冲突，所以请卸载旧版本的VitrualBox。
"><meta name=keywords content="swift,iOS,积极主动,以终为始,要事第一,效能平衡"><meta name=generator content="Hugo 0.150.0 with theme even"><link rel=canonical href=https://it-boyer.github.io/post/old/%E5%85%B6%E4%BB%96/Docker%E4%BD%BF%E7%94%A8/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link href=/sass/main.min.d4d0dce78b3ec6333437bc36540c4749ae9a27ff4ca2d7562da2dbfbf991dde3.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=/css/search.css><link rel=stylesheet href=/css/copy-to-clipboard.css><link rel=stylesheet href=/css/todo.css><meta property="og:url" content="https://it-boyer.github.io/post/old/%E5%85%B6%E4%BB%96/Docker%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="习七"><meta property="og:title" content="Docker使用"><meta property="og:description" content="安装Docker for Mac 在Mac上运行Docker。系统要求，OS X 10.10.3 或者更高版本，至少4G内存，4.3.30版本以前的VirtualBox会与Docker for Mac产生冲突，所以请卸载旧版本的VitrualBox。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-12-21T21:25:29+00:00"><meta property="article:modified_time" content="2016-12-21T21:25:29+00:00"><meta property="article:tag" content="Docker"><meta itemprop=name content="Docker使用"><meta itemprop=description content="安装Docker for Mac 在Mac上运行Docker。系统要求，OS X 10.10.3 或者更高版本，至少4G内存，4.3.30版本以前的VirtualBox会与Docker for Mac产生冲突，所以请卸载旧版本的VitrualBox。"><meta itemprop=datePublished content="2016-12-21T21:25:29+00:00"><meta itemprop=dateModified content="2016-12-21T21:25:29+00:00"><meta itemprop=wordCount content="2747"><meta itemprop=keywords content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker使用"><meta name=twitter:description content="安装Docker for Mac 在Mac上运行Docker。系统要求，OS X 10.10.3 或者更高版本，至少4G内存，4.3.30版本以前的VirtualBox会与Docker for Mac产生冲突，所以请卸载旧版本的VitrualBox。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script>(function(){""&&prompt("请输入文章密码")!==""&&(alert("密码错误！"),history.back())})()</script></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>习七</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>主页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=/categories/%E5%91%A8%E6%8A%A5/><li class=mobile-menu-item>周报</li></a><a href=/iDocs/><li class=mobile-menu-item>文档</li></a><a href=/authors/itboyer/><li class=mobile-menu-item>关于</li></a><a href=/resume><li class=mobile-menu-item>认识我</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>习七</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>主页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=/categories/%E5%91%A8%E6%8A%A5/>周报</a></li><li class=menu-item><a class=menu-item-link href=/iDocs/>文档</a></li><li class=menu-item><a class=menu-item-link href=/authors/itboyer/>关于</a></li><li class=menu-item><a class=menu-item-link href=/resume>认识我</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Docker使用</h1><div class=post-meta><span class=post-time>2016-12-21</span><div class=post-category><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a></div><span class=more-meta>约 2747 字 </span><span class=more-meta>预计阅读 6 分钟 </span><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读 </span><span class=more-meta>by</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#>安装Docker for Mac</a><ul><li><a href=#>配置 Docker 加速器镜像源</a></li><li><a href=#>安装主机监控程序加速器</a></li><li><a href=#>从Docker Hub 仓库中获取一个镜像</a></li></ul></li><li><a href=#>Docker 命令创建管理容器</a><ul><li><a href=#>获取镜像的两种方式</a></li><li><a href=#>通过镜像创建容器</a></li><li><a href=#>ps 查看容器状态</a></li><li><a href=#>容器ID标识</a></li><li><a href=#>启动/退出/移除容器</a></li></ul></li><li><a href=#>创建管理镜像</a><ul><li><a href=#>将容器创建为镜像</a></li><li><a href=#>Dockerfile</a></li></ul></li></ul></nav></div></div><div class=post-outdated><div class=warn><p>【注意】最后更新于 <span class=timeago datetime=2016-12-21T21:25:29 title="December 21, 2016">December 21, 2016</span>，文中内容可能已过时，请谨慎使用。</p></div></div><div class=post-content><h2>安装<a href=https://www.docker.com/products/docker#/mac>Docker for Mac</a></h2><p>在Mac上运行Docker。系统要求，OS X 10.10.3 或者更高版本，至少4G内存，4.3.30版本以前的VirtualBox会与Docker for Mac产生冲突，所以请卸载旧版本的VitrualBox。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>echo</span> <span class=s1>&#39;下载dmg...&#39;</span>
</span></span><span class=line><span class=cl><span class=n>curl</span> <span class=o>-</span><span class=n>o</span> <span class=no>Docker</span><span class=o>.</span><span class=n>dmg</span> <span class=ss>https</span><span class=p>:</span><span class=sr>//</span><span class=n>dn</span><span class=o>-</span><span class=n>dao</span><span class=o>-</span><span class=n>github</span><span class=o>-</span><span class=n>mirror</span><span class=o>.</span><span class=n>qbox</span><span class=o>.</span><span class=n>me</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>install</span><span class=o>/</span><span class=n>mac</span><span class=o>/</span><span class=no>Docker</span><span class=o>.</span><span class=n>dmg</span>
</span></span><span class=line><span class=cl><span class=c1>#安装Docker.dmg</span>
</span></span><span class=line><span class=cl><span class=no>MOUNTDIR</span><span class=o>=</span><span class=err>$</span><span class=p>(</span><span class=n>echo</span> <span class=sb>`hdiutil mount Docker.dmg | tail -1 \
</span></span></span><span class=line><span class=cl><span class=sb>| awk &#39;{$1=$2=&#34;&#34;; print $0}&#39;`</span> <span class=o>|</span> <span class=n>xargs</span> <span class=o>-</span><span class=mi>0</span> <span class=n>echo</span><span class=p>)</span> <span class=p>\</span>
</span></span><span class=line><span class=cl><span class=o>&amp;&amp;</span> <span class=n>cd</span> <span class=err>$</span><span class=p>{</span><span class=no>MOUNTDIR</span><span class=p>}</span> <span class=o>&amp;&amp;</span> <span class=n>cp</span> <span class=o>-</span><span class=n>R</span> <span class=no>Docker</span><span class=o>.</span><span class=n>app</span> <span class=sr>/Applications/</span> <span class=p>\</span>
</span></span><span class=line><span class=cl><span class=o>&amp;&amp;</span> <span class=nb>open</span> <span class=sr>/Applications/</span><span class=no>Docker</span><span class=o>.</span><span class=n>app</span>
</span></span></code></pre></td></tr></table></div></div><h3>配置 Docker 加速器镜像源</h3><p><a href=https://www.daocloud.io/mirror>国内加速器</a>
右键点击桌面顶栏的 docker 图标，选择 Preferences ，在 Advanced 标签下的 Registry mirrors 列表中加入下面的镜像地址:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://f1361db2.m.daocloud.io
</span></span></code></pre></td></tr></table></div></div><p>点击 Apply & Restart 按钮使设置生效。</p><h3>安装主机监控程序加速器</h3><hr><ol><li>登录到 <code>DaoCloud 控制台</code>，点击「我的集群」按钮，在「接入自有主机」界面，点击 Mac 按钮。</li><li>安装<a href=https://github.com/docker/toolbox/releases/>DockerToolbox</a>，是一个完整的开发组件，通过安装和配置<code>DaoCloud加速器 v2</code>，提升下载 <code>Docker Hub 镜像</code>的速度。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span><span class=err>下载</span><span class=n>pkg</span>
</span></span><span class=line><span class=cl><span class=n>curl</span> <span class=o>-</span><span class=n>o</span> <span class=n>DockerToolbox</span><span class=o>.</span><span class=n>pkg</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>toolbox</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v18</span><span class=o>.</span><span class=mf>09.0</span><span class=o>/</span><span class=n>DockerToolbox</span><span class=o>-</span><span class=mf>18.09</span><span class=o>.</span><span class=mf>0.</span><span class=n>pkg</span>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=err>安装</span><span class=n>pkg</span>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=n>installer</span> <span class=o>-</span><span class=n>pkg</span> <span class=n>DockerToolbox</span><span class=o>.</span><span class=n>pkg</span> <span class=o>-</span><span class=n>target</span> <span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>安装Toolbox好了，下一步：
<img src=http://docs.daocloud.io/user/pages/03.faq/08.install-docker-daocloud/DashboardDaoCloudInstall.png alt></li><li><code>$ docker-machine start default</code>启动 Docker.
当执行后提示：<code>Host does not exist: "default"</code>
{% codeblock docker-machine create <a href=http://stackoverflow.com/a/38602630>http://stackoverflow.com/a/38602630</a> stackoverflow %}
docker-machine create -d virtualbox default
{% endcodeblock %}</li><li>在 <code>Docker 主机</code> DaoCloud 加速器的组件包：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>curl</span> <span class=o>-</span><span class=n>sSL</span> <span class=ss>https</span><span class=p>:</span><span class=sr>//</span><span class=n>get</span><span class=o>.</span><span class=n>daocloud</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>daomonit</span><span class=o>/</span><span class=n>install</span><span class=o>.</span><span class=n>sh</span> <span class=o>|</span> <span class=n>sh</span> <span class=o>-</span><span class=n>s</span> <span class=n>d0312f829e9807ee0bf157</span><span class=o>******</span>
</span></span></code></pre></td></tr></table></div></div><ol start=6><li>启动组件包,会在「安装主机监控程序」的 DaoCloud 控制台页面下方显示一台已经接入的主机。</li><li>执行<code>Dao Pull</code>命令,高速下载<code>Docker Hub</code>镜像文件
这台 Docker 主机已经被接入 DaoCloud 平台，用户可以在 DaoCloud 控制台的「我的集群」页面发现这台主机，可以执行管理和部署应用的操作。</li></ol><h3>从Docker Hub 仓库中获取一个镜像</h3><hr><p>Docker 使用类似 git 的方式管理镜像。通过基本的镜像可以定制创建出来不同种应用的 Docker 镜像。Docker Hub 是 Docker 官方提供的镜像中心。在这里可以很方便地找到各类应用、环境的镜像。由于 Docker 使用联合文件系统，所以镜像就像是夹心饼干一样一层层构成，相同底层的镜像可以共享。所以 Docker 还是相当节约磁盘空间的。要使用一 个镜像，需要先从远程的镜像注册中心拉取，这点非常类似 git。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>pull</span> <span class=n>ubuntu</span>
</span></span></code></pre></td></tr></table></div></div><h2>Docker 命令创建管理容器</h2><hr><h3>获取镜像的两种方式</h3><hr><h4>1. <code>docker pull</code>命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>search</span> <span class=n>perfectlysoft</span><span class=o>/</span><span class=n>ubuntu</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>pull</span> <span class=n>perfectlysoft</span><span class=o>/</span><span class=n>ubuntu</span>
</span></span></code></pre></td></tr></table></div></div><h4>2. <code>docker import</code>命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>import</span> <span class=n>myubuntu</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>
</span></span></code></pre></td></tr></table></div></div><h3>通过镜像创建容器</h3><hr><p>创建一个容器有两种方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>create</span> <span class=err>镜像名</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>run</span>   <span class=err>镜像名</span>   <span class=sr>//</span><span class=err>立即启动容器</span> <span class=err>等价于：</span><span class=n>create</span> <span class=o>+</span> <span class=n>start</span> <span class=err>命令组合</span>
</span></span></code></pre></td></tr></table></div></div><p>进入容器终端控制台如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>root</span><span class=err>@</span><span class=n>ec72dc76502e</span><span class=p>:</span><span class=o>/</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl><span class=n>app</span>  <span class=n>boot</span>  <span class=n>etc</span>   <span class=n>lib</span>    <span class=n>media</span>  <span class=n>opt</span>   <span class=n>root</span>  <span class=n>sbin</span>  <span class=n>sys</span>  <span class=n>usr</span>
</span></span><span class=line><span class=cl><span class=n>bin</span>  <span class=n>dev</span>   <span class=n>home</span>  <span class=n>lib64</span>  <span class=n>mnt</span>    <span class=n>proc</span>  <span class=n>run</span>   <span class=n>srv</span>   <span class=n>tmp</span>  <span class=k>var</span>
</span></span></code></pre></td></tr></table></div></div><h4><code>docker run images</code>命令</h4><ol><li>样例1
执行<code>run images</code>，并将 Ubuntu 的 Shell 作为入口，进入Docker容器环境操作</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>run</span> <span class=o>-</span><span class=n>it</span> <span class=ss>ubuntu</span><span class=p>:</span><span class=n>latest</span> <span class=n>sh</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;/bin/bash&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>样例2
执行<code>docker start -i 容器</code>命令进入容器环境</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker start -i 容器ID/容器名
</span></span></code></pre></td></tr></table></div></div><h4>从<code>Kitematic</code>GUI进入容器环境</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>bash</span> <span class=o>-</span><span class=n>c</span> <span class=s2>&#34;clear &amp;&amp; docker exec -it perfectswift sh&#34;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>参数
-i 表示这是一个交互容器，会把当前标准输入重定向到容器的标准输入中，而不是终止程序运行
-t 指为这个容器分配一个终端</p></blockquote><p>这时候我们成功创建了一个 Ubuntu 的容器，并将当前终端连接为这个 Ubuntu 的 bash shell。这时候就可以愉快地使用 Ubuntu 的相关命令了。</p><h3>ps 查看容器状态</h3><hr><p>在容器运行期间，我们可以通过 <code>docker ps</code> 命令看到所有当前正在运行的容器。
添加-a参数可以看到所有创建的容器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>ps</span> <span class=o>-</span><span class=n>a</span>
</span></span></code></pre></td></tr></table></div></div><h3>容器ID标识</h3><hr><p>每个容器都有一个唯一的 ID 标识，通过 ID 可以对这个容器进行管理和操作。在创建容器时，我们可以通过 &ndash;name 参数指定一个容器名称，如果没有指定系统将会分配一个，就像这里的「trusting_morse」。</p><h3>启动/退出/移除容器</h3><hr><p>启动：<code>start</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>start</span> <span class=o>-</span><span class=n>i</span> <span class=n>trusting_morse</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：每次执行 docker run 命令都会创建新的容器，建议一次创建后，使用 docker start/stop 来启动和停用容器。</p></blockquote><p>退出：
按 <code>Ctrl+D</code> 退出</p><p>移除：<code>rm</code>ID/name</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker rm [CONTAINER ID/NAMES]
</span></span></code></pre></td></tr></table></div></div><p>重命名：<code>rename</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker rename 容器ID newName
</span></span></code></pre></td></tr></table></div></div><h2>创建管理镜像</h2><hr><p>Docker 强大的威力在于可以把自己开发的应用随同各种依赖环境一起打包、分发、运行。要创建一个新的 Docker 镜像，通常基于一个已有的 Docker 镜像来创建。
Docker 提供了两种方式来创建镜像：</p><ol><li>把容器创建为一个新的镜像</li><li>使用 Dockerfile 创建镜像。</li></ol><h3>将容器创建为镜像</h3><hr><ol><li>为了创建一个新的镜像，我们先创建一个新的容器作为基底：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>run</span> <span class=o>-</span><span class=n>it</span> <span class=ss>ubuntu</span><span class=p>:</span><span class=n>latest</span> <span class=n>sh</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;/bin/bash&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>定制这个容器，例如我们可以配置 PHP 环境、将我们的项目代码部署在里面等：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>apt</span><span class=o>-</span><span class=n>get</span> <span class=n>install</span> <span class=n>php</span>
</span></span><span class=line><span class=cl><span class=c1># some other opreations ...</span>
</span></span></code></pre></td></tr></table></div></div><p>当执行完操作之后，我们按 Ctrl+D 退出容器.
3. 获取定制后的容器ID</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    docker ps -a
</span></span><span class=line><span class=cl>    [root@localhost ~]# docker ps -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    CONTAINER ID        IMAGE                        COMMAND                    CREATED             STATUS                      PORTS               NAMES
</span></span><span class=line><span class=cl>    cb2b06c83a50        ubuntu:latest                &#34;sh -c /bin/bash&#34;          7 minutes ago       Exited (0) 7 seconds ago                       trusting_morse
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>执行<code>docker commit</code> 把这个容器变为一个镜像：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker commit cb2b06c83a50 ubuntu:myubuntu
</span></span></code></pre></td></tr></table></div></div><p>这时候 docker 容器会被创建为一个新的 Ubuntu 镜像，版本名称为 myubuntu。以后我们可以随时使用这个镜像来创建容器了，新的容器将自动包含上面对容器的操作。<br>5. 打包/发布镜像</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>save</span> <span class=o>-</span><span class=n>o</span> <span class=n>myubuntu</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span> <span class=ss>ubuntu</span><span class=p>:</span><span class=n>myubuntu</span>
</span></span></code></pre></td></tr></table></div></div><ol start=6><li>导入打包镜像</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>import</span> <span class=n>myubuntu</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>
</span></span></code></pre></td></tr></table></div></div><h3>Dockerfile</h3><hr><h4>通过<code>Dockerfile</code>创建镜像</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>build</span> <span class=n>yourDir</span><span class=o>/</span><span class=no>Dockerfile</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>确保Dockerfile文件在一个目录中，否则会提示错误</p></blockquote><p>Docker Hub 提供了类似 GitHub 的镜像存管服务。一个镜像发布到 Docker Hub 不仅可以供更多人使用，而且便于镜像的版本管理。在一个企业内部可以通过自建 Docker Registry 的方式来统一管理和发布镜像。将 Docker Registry 集成到版本管理和上线发布的工作流之中，还有许多工作要做，在我整理出最佳实践后会第一时间分享。
使用命令行的方式创建 Docker 镜像通常难以自动化操作。在更多的时候，我们使用 Dockerfile 来创建 Docker 镜像。Dockerfile 是一个纯文本文件，它记载了从一个镜像创建另一个新镜像的步骤。撰写好 Dockerfile 文件之后，我们就可以轻而易举的使用 docker build 命令来创建镜像了。
Dockerfile 非常简单，仅有以下命令在 Dockerfile 中常被使用：</p><table><thead><tr><th style=text-align:right>命令</th><th style=text-align:right>参数</th><th style=text-align:right>说明</th></tr></thead><tbody><tr><td style=text-align:right>#</td><td style=text-align:right>-</td><td style=text-align:right>注释说明</td></tr><tr><td style=text-align:right>FROM</td><td style=text-align:right><image>[:<tag>]</td><td style=text-align:right>从一个已有镜像创建，例如ubuntu:latest</td></tr><tr><td style=text-align:right>MAINTAINER</td><td style=text-align:right>Author <a href=mailto:some-one@example.com>some-one@example.com</a></td><td style=text-align:right>镜像作者名字，如Max Liu <a href=mailto:some-one@example.com>some-one@example.com</a></td></tr><tr><td style=text-align:right>RUN</td><td style=text-align:right><cmd>或者[&lsquo;cmd1&rsquo;, &lsquo;cmd2&rsquo;…]</td><td style=text-align:right>在镜像创建用的临时容器里执行单行命令</td></tr><tr><td style=text-align:right>ADD</td><td style=text-align:right><src><dest></td><td style=text-align:right>将本地的<src>添加到镜像容器中的<dest>位置</td></tr><tr><td style=text-align:right>VOLUME</td><td style=text-align:right><path>或者[&rsquo;/var&rsquo;, &lsquo;home&rsquo;]</td><td style=text-align:right>将指定的路径挂载为数据卷</td></tr><tr><td style=text-align:right>EXPOSE</td><td style=text-align:right><port>[<port>&mldr;]</td><td style=text-align:right>将指定的端口暴露给主机</td></tr><tr><td style=text-align:right>ENV</td><td style=text-align:right><key><value>或者 <key>= <value></td><td style=text-align:right>指定环境变量值</td></tr><tr><td style=text-align:right>CMD</td><td style=text-align:right>[&ldquo;executable&rdquo;,&ldquo;param1&rdquo;,&ldquo;param2&rdquo;]</td><td style=text-align:right>容器启动时默认执行的命令。注意一个Dockerfile中只有最后一个CMD生效。</td></tr><tr><td style=text-align:right>ENTRYPOINT</td><td style=text-align:right>[&ldquo;executable&rdquo;, &ldquo;param1&rdquo;, &ldquo;param2&rdquo;]</td><td style=text-align:right>容器的进入点</td></tr></tbody></table><h4>配置Dockerfile</h4><hr><p>下面是一个 Dockerfile 的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=c1># This is a comment</span>
</span></span><span class=line><span class=cl><span class=no>FROM</span> <span class=ss>ubuntu</span><span class=p>:</span><span class=mi>14</span><span class=o>.</span><span class=mo>04</span>
</span></span><span class=line><span class=cl><span class=no>MAINTAINER</span> <span class=no>Kate</span> <span class=no>Smith</span> <span class=o>&lt;</span><span class=n>ksmith</span><span class=vi>@example</span><span class=o>.</span><span class=n>com</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=no>RUN</span> <span class=n>apt</span><span class=o>-</span><span class=n>get</span> <span class=n>update</span> <span class=o>&amp;&amp;</span> <span class=n>apt</span><span class=o>-</span><span class=n>get</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>ruby</span> <span class=n>ruby</span><span class=o>-</span><span class=n>dev</span>
</span></span><span class=line><span class=cl><span class=no>RUN</span> <span class=n>gem</span> <span class=n>install</span> <span class=n>sinatra</span>
</span></span></code></pre></td></tr></table></div></div><h5><code>CMD</code>命令</h5><hr><p><code>CMD</code>: 命令可用指定 Docker 容器启动时默认的命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -it ubuntu:latest sh -c &#39;/bin/bash&#39;
</span></span></code></pre></td></tr></table></div></div><p>其中 <code>sh -c '/bin/bash'</code> 就是手工指定的<code>CMD</code>,否则容器将会使用默认 <code>CMD</code> 指定的命令启动。</p><h5><code>ENTRYPOINT</code>命令</h5><hr><p>用来指定可执行文件、Shell 脚本，同时会并把启动参数或 CMD 指定的默认值，当作附加参数传递给 执行文件、Shell 脚本。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>ENTRYPOINT</span> <span class=o>[</span><span class=s1>&#39;/usr/bin/mysql&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=no>CMD</span> <span class=o>[</span><span class=s1>&#39;-h 192.168.100.128&#39;</span><span class=p>,</span> <span class=s1>&#39;-p&#39;</span><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>执行mysql启动程序，连接<code>192.168.100.128</code> 主机,也可以通过指定参数，来连接别的主机。</p><p>因此，我们在使用 Dockerfile 创建文件的时候，可以创建一个 entrypoint.sh 脚本，作为系统入口。在这个文件里面，我们可以进行一些基础性的自举操作，比如检查环境变量，根据需要初始化数据库等等。下面两个文件是我在日常工作的项目中添加的 Dockerfile 和 entrypoint.sh，仅供参考：
<a href=https://github.com/starlight36/SimpleOA/blob/master/Dockerfile>https://github.com/starlight36/SimpleOA/blob/master/Dockerfile</a>
<a href=https://github.com/starlight36/SimpleOA/blob/master/docker-entrypoint.sh>https://github.com/starlight36/SimpleOA/blob/master/docker-entrypoint.sh</a>
在准备好 Dockerfile 之后，我们就可以创建镜像了：</p><h4>创建镜像</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>docker</span> <span class=n>build</span> <span class=o>-</span><span class=n>t</span> <span class=n>starlight36</span><span class=o>/</span><span class=n>simpleoa</span> <span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>iTBoyer</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2016-12-21</span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/img/reward/weixin.jpg>
<span>微信打赏</span>
</label><label class=qr-code-image for=reward><img class=image src=/img/reward/zhifubao.jpg>
<span>支付宝打赏</span></label></div></div><footer class=post-footer><div class=post-tags><a href=/tags/docker/>docker</a></div><nav class=post-nav><a class=prev href=/post/old/swift/SwiftGuide/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Swift 语言指南[转]</span>
<span class="prev-text nav-mobile">上一篇</span>
</a><a class=next href=/post/old/hexo/hackmd%E4%BD%BF%E7%94%A8/><span class="next-text nav-default">hackmd使用</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js crossorigin=anonymous></script><script type=text/javascript>var gitalk=new Gitalk({id:"2016-12-21 21:25:29 +0000 UTC",title:"Docker使用",clientID:"d46ea301857e36a08319",clientSecret:"9da00f1f475c4166b96fbe157d0afdbd64cc613c",repo:"it-boyer.github.io",owner:"it-boyer",admin:["it-boyer"],body:decodeURI(location.href)});gitalk.render("gitalk-container")</script><noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:iTBoyer@qq.com class="iconfont icon-email" title=email></a><a href=https://github.com/it-boyer class="iconfont icon-github" title=github></a><a href=http://weibo.com/1791281385 class="iconfont icon-weibo" title=weibo></a><a href=http://www.zhihu.com/people/boyers class="iconfont icon-zhihu" title=zhihu></a><a href=http://douban.com/people/boyers class="iconfont icon-douban" title=douban></a><a href=https://space.bilibili.com/67083417 class="iconfont icon-bilibili" title=bilibili></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span><span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次
</span><span class=division>|</span> <span id=busuanzi_container_site_uv>本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人</span></div><span class=copyright-year>&copy; 2017 - 2025<span class=heart><i class="iconfont icon-heart"></i></span><span>iTBoyer</span></span></div><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script><script src=/js/copy-to-clipboard.js></script></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin=anonymous></script><script>var languageCode="zh-cn".replace(/-/g,"_").replace(/_(.*)/,function(e,t){return e.replace(t,t.toUpperCase())});timeago().render(document.querySelectorAll(".timeago"),languageCode),timeago.cancel()</script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html><style>#fastSearch{visibility:hidden;position:absolute;left:10px;top:10px;display:inline-block;width:320px;margin:0 10px 0 0;padding:0}#fastSearch input{padding:4px;width:100%;height:31px;font-size:1.6em;color:#222129;font-weight:700;background-color:gray;border-radius:3px 3px 0 0;border:none;outline:none;text-align:left;display:inline-block}#searchResults li{list-style:none;margin-left:0;background-color:gray;border-bottom:1px dotted #000}#searchResults li .title{font-size:1.1em;margin:0;display:inline-block}#searchResults{visibility:inherit;display:inline-block;width:320px;margin:0;max-height:calc(100vh - 120px);overflow:hidden}#searchResults a{text-decoration:none!important;padding:10px;display:inline-block;width:100%}#searchResults a:hover,#searchResults a:focus{outline:0;background-color:#666;color:#fff}#search-btn{position:absolute;top:10px;right:20px;font-size:24px}@media(max-width:683px){#fastSearch,#search-btn{top:64px}}</style><div id=fastSearch><input id=searchInput tabindex=0><ul id=searchResults></ul></div><script src=/js/fuse.js></script><script src=/js/fastsearch.js></script>